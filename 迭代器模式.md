# 应用场景

迭代器模式主要作用是解耦容器代码和遍历代码。



# 原理解读

迭代器是用来遍历容器的，所以，一个完整的迭代器模式一般会涉及容器和容器迭代器两部分内容。为了达到基于接口而非实现编程的目的，容器又包含容器接口、容器实现类，迭代器又包含迭代器接口、迭代器实现类。



# 代码实现

一个完整的迭代器模式，一般会涉及容器和容器迭代器两部分内容。为了达到基于接口而非实现编程的目的，容器又包含容器接口、容器实现类，迭代器又包含迭代器接口、迭代器实现类。容器中需要定义 iterator() 方法，用来创建迭代器。迭代器接口中需要定义 hasNext()、currentItem()、next() 三个最基本的方法。容器对象通过依赖注入传递到迭代器类中。遍历集合一般有三种方式：for 循环、foreach 循环、迭代器遍历。后两种本质上属于一种，都可以看作迭代器遍历。

相对于 for 循环遍历，利用迭代器来遍历有下面三个优势：

- 迭代器模式封装集合内部的复杂数据结构，开发者不需要了解如何遍历，直接使用容器提供的迭代器即可；

- 迭代器模式将集合对象的遍历操作从集合类中拆分出来，放到迭代器类中，让两者的职责更加单一；

- 迭代器模式让添加新的遍历算法更加容易，更符合开闭原则。除此之外，因为迭代器都实现自相同的接口，在开发中，基于接口而非实现编程，替换迭代器也变得更加容易。

  

## 相关demo目录：



## 遍历时安全的增删集合

### 在遍历的同时增删集合元素会发生什么？

在通过迭代器来遍历集合元素的同时，增加或者删除集合中的元素，有可能会导致某个元素被重复遍历或遍历不到。不过，并不是所有情况下都会遍历出错，有的时候也可以正常遍历，所以，这种行为称为**结果不可预期行为**或者**未决行为**，也就是说，运行结果到底是对还是错，要视情况而定。

### **如何应对遍历时改变集合导致的未决行为**？

- 遍历的时候不允许增删元素；

  实现这个需要知道遍历开始和结束时间，开始时间容易，结束时间的确定不太容易，会额外增加开发成本。

- 增删元素之后让遍历报错。

  这种方案更合理。Java 语言当中就是采用这用解决方案，增删元素之后，选择 fail-fast 解决方式，让遍历操作直接抛出运行时异常。

### 如何在遍历的同时安全地删除集合元素？

像 Java 语言中 remove() 方法



## 如何实现一个支持“快照”功能的迭代器模式？

